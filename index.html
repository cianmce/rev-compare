 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rev Compare</title>
    <!-- Tailwind CSS CDN for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN for interactive charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Inter Font for clean typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Apply Inter font and a light gray background to the body */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
            color: #374151; /* Dark gray text */
        }
        /* Custom gradient for the main title, mimicking Revolut's branding */
        .gradient-text {
            background-image: linear-gradient(to right, #3b82f6, #6366f1); /* Blue to Indigo */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* Hide spin buttons for number input fields for a cleaner look */
        input[type="number"] {
            -moz-appearance: textfield; /* Firefox */
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* Styling for the custom toggle switch */
        .dot {
            left: 0.25rem; /* Initial position for the toggle dot */
        }
        input:checked + .block {
            background-color: #6366f1; /* Indigo background when checked */
        }
        input:checked + .block + .dot {
            transform: translateX(1.5rem); /* Move dot to the right when checked */
        }
        /* Custom scrollbar for tables for better aesthetics */
        .overflow-x-auto::-webkit-scrollbar {
            height: 8px;
        }
        .overflow-x-auto::-webkit-scrollbar-track {
            background: #e0e7ff; /* Light blue track */
            border-radius: 10px;
        }
        .overflow-x-auto::-webkit-scrollbar-thumb {
            background: #93c5fd; /* Medium blue thumb */
            border-radius: 10px;
        }
        .overflow-x-auto::-webkit-scrollbar-thumb:hover {
            background: #60a5fa; /* Darker blue on hover */
        }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">
    <div class="max-w-7xl mx-auto bg-white shadow-xl rounded-xl p-6 sm:p-8 lg:p-10 mb-8">
        <div class="relative mb-10">
            <!-- Revolut Logo -->
            <img src="https://i.imgur.com/5BsoJus.png" alt="Revolut Logo" class="absolute top-0 left-0 h-10 sm:h-12 w-auto" onerror="this.onerror=null;this.src='https://placehold.co/48x48/CCCCCC/FFFFFF?text=Logo';">
            <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold text-center gradient-text">Rev Compare</h1>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
            <!-- Plan Fees Section: Allows users to modify plan costs -->
            <div class="bg-gray-50 p-6 rounded-lg shadow-sm border border-gray-200">
                <h2 class="text-2xl font-semibold mb-4 text-gray-800">Plan Fees (€)</h2>
                <!-- Billing period toggle switch -->
                <div class="flex items-center mb-6">
                    <span class="mr-3 text-gray-700 font-medium">Bill per Month</span>
                    <label for="billingToggle" class="flex items-center cursor-pointer">
                        <div class="relative">
                            <!-- Checked by default for annual billing -->
                            <input type="checkbox" id="billingToggle" class="sr-only" checked>
                            <div class="block bg-gray-300 w-14 h-8 rounded-full transition"></div>
                            <div class="dot absolute top-1 bg-white w-6 h-6 rounded-full transition shadow-md"></div>
                        </div>
                    </label>
                    <span class="ml-3 text-gray-700 font-medium">Bill per Year</span>
                </div>
                <!-- Input fields for each plan's cost -->
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <label for="standardPrice" class="text-lg text-gray-700">Standard (free)</label>
                        <input type="number" id="standardPrice" value="0" readonly class="w-28 p-2 border border-gray-300 rounded-md bg-gray-100 text-right text-gray-600 font-mono">
                    </div>
                    <div class="flex items-center justify-between">
                        <label for="plusPrice" class="text-lg text-gray-700">Plus</label>
                        <input type="number" id="plusPrice" value="47.88" step="0.01" class="w-28 p-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-right font-mono">
                    </div>
                    <div class="flex items-center justify-between">
                        <label for="premiumPrice" class="text-lg text-gray-700">Premium</label>
                        <input type="number" id="premiumPrice" value="90" step="0.01" class="w-28 p-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-right font-mono">
                    </div>
                    <div class="flex items-center justify-between">
                        <label for="metalPrice" class="text-lg text-gray-700">Metal</label>
                        <input type="number" id="metalPrice" value="155" step="0.01" class="w-28 p-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-right font-mono">
                    </div>
                    <div class="flex items-center justify-between">
                        <label for="ultraPrice" class="text-lg text-gray-700">Ultra</label>
                        <input type="number" id="ultraPrice" value="540" step="0.01" class="w-28 p-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-right font-mono">
                    </div>
                </div>
            </div>

            <!-- Savings Rates Section: Input for flexible and instant access rates -->
            <div class="bg-gray-50 p-6 rounded-lg shadow-sm border border-gray-200">
                <h2 class="text-2xl font-semibold mb-4 text-gray-800">Savings Rates (%)</h2>
                <div class="space-y-6">
                    <div>
                        <h3 class="text-xl font-medium mb-3 text-gray-700">Flexible Cash Fund (Net Rate)</h3>
                        <div class="space-y-4">
                            <!-- Input fields for Flexible Cash Fund rates -->
                            <div class="flex items-center justify-between">
                                <label for="flexibleStandard" class="text-lg text-gray-700">Standard</label>
                                <input type="number" id="flexibleStandard" value="0.86" step="0.01" class="w-28 p-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-right font-mono">
                            </div>
                            <div class="flex items-center justify-between">
                                <label for="flexiblePlus" class="text-lg text-gray-700">Plus</label>
                                <input type="number" id="flexiblePlus" value="0.91" step="0.01" class="w-28 p-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-right font-mono">
                            </div>
                            <div class="flex items-center justify-between">
                                <label for="flexiblePremium" class="text-lg text-gray-700">Premium</label>
                                <input type="number" id="flexiblePremium" value="1.11" step="0.01" class="w-28 p-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-right font-mono">
                            </div>
                            <div class="flex items-center justify-between">
                                <label for="flexibleMetal" class="text-lg text-gray-700">Metal</label>
                                <input type="number" id="flexibleMetal" value="1.21" step="0.01" class="w-28 p-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-right font-mono">
                            </div>
                            <div class="flex items-center justify-between">
                                <label for="flexibleUltra" class="text-lg text-gray-700">Ultra</label>
                                <input type="number" id="flexibleUltra" value="1.31" step="0.01" class="w-28 p-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-right font-mono">
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-medium mb-3 text-gray-700">Instant Access Savings (AER Rate)</h3>
                        <p class="text-sm text-gray-500 mb-4">DIRT Tax Rate: 33% (fixed)</p>
                        <div class="space-y-4">
                            <!-- Input fields for Instant Access AER rates -->
                            <div class="flex items-center justify-between">
                                <label for="instantStandard" class="text-lg text-gray-700">Standard</label>
                                <input type="number" id="instantStandard" value="1.7" step="0.01" class="w-28 p-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-right font-mono">
                            </div>
                            <div class="flex items-center justify-between">
                                <label for="instantPlus" class="text-lg text-gray-700">Plus</label>
                                <input type="number" id="instantPlus" value="1.7" step="0.01" class="w-28 p-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-right font-mono">
                            </div>
                            <div class="flex items-center justify-between">
                                <label for="instantPremium" class="text-lg text-gray-700">Premium</label>
                                <input type="number" id="instantPremium" value="1.85" step="0.01" class="w-28 p-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-right font-mono">
                            </div>
                            <div class="flex items-center justify-between">
                                <label for="instantMetal" class="text-lg text-gray-700">Metal</label>
                                <input type="number" id="instantMetal" value="2" step="0.01" class="w-28 p-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-right font-mono">
                            </div>
                            <div class="flex items-center justify-between">
                                <label for="instantUltra" class="text-lg text-gray-700">Ultra</label>
                                <input type="number" id="instantUltra" value="2.5" step="0.01" class="w-28 p-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-right font-mono">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Plans Overview Table: Displays current rates and costs for all plans -->
        <div class="mb-10">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Plan Overview</h2>
            <div class="overflow-x-auto rounded-lg shadow-sm border border-gray-200">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-blue-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider rounded-tl-lg">Plan</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">Cost (<span id="costUnit">€/Month</span>)</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">Flexible Cash Fund Net Rate (%)</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">Instant Access Savings AER Rate (%)</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider rounded-tr-lg">Instant Access Savings Net Rate (%)</th>
                        </tr>
                    </thead>
                    <tbody id="planOverviewTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Rows will be populated dynamically by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Break-Even Amounts Table: Shows how much to invest to cover plan costs compared to Standard plan -->
        <div class="mb-10">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Break-Even Amounts (€) vs Standard Tier (Max Net Rate)</h2>
            <div class="overflow-x-auto rounded-lg shadow-sm border border-gray-200">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-purple-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-purple-700 uppercase tracking-wider rounded-tl-lg">Plan</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-purple-700 uppercase tracking-wider">Annual Cost (<span id="annualCostUnit">€/Year</span>)</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-purple-700 uppercase tracking-wider">Additional Net Rate (%)</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-purple-700 uppercase tracking-wider rounded-tr-lg">Amount to Break Even (€)</th>
                        </tr>
                    </thead>
                    <tbody id="breakEvenTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Rows will be populated dynamically by JavaScript -->
                    </tbody>
                </table>
            </div>
            <p class="mt-4 text-sm text-gray-600">
                The "Amount to Break Even" indicates the investment required for the annual interest earned on the difference in net rates (compared to the best performing Standard tier savings option) to fully cover the annual cost of the selected plan.
            </p>
        </div>


        <!-- Daily Interest Earnings Section: Calculate interest for a user-specified investment -->
        <div class="mb-10">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Daily Interest Earnings</h2>
            <div class="flex flex-col sm:flex-row items-start sm:items-center mb-4 space-y-2 sm:space-y-0 sm:space-x-4">
                <label for="investmentAmount" class="text-lg text-gray-700">Enter Investment Amount (€):</label>
                <input type="number" id="investmentAmount" value="10000" step="100" min="0" class="w-full sm:w-48 p-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-right font-mono">
            </div>
            <div class="overflow-x-auto rounded-lg shadow-sm border border-gray-200">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-green-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider rounded-tl-lg">Plan</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">Flexible Cash Fund Daily Interest (€)</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider rounded-tr-lg">Instant Access Savings Daily Interest (€)</th>
                        </tr>
                    </thead>
                    <tbody id="dailyInterestTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Rows will be populated dynamically by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Compound Interest Growth Section: Shows yearly growth for a period -->
        <div class="mb-10">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Compound Interest Growth</h2>
            <div class="flex flex-col sm:flex-row items-start sm:items-center mb-4 space-y-2 sm:space-y-0 sm:space-x-4">
                <label for="compoundPeriodYears" class="text-lg text-gray-700">Period (Years):</label>
                <input type="number" id="compoundPeriodYears" value="5" step="1" min="1" class="w-full sm:w-28 p-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-right font-mono">
            </div>
            <div class="overflow-x-auto rounded-lg shadow-sm border border-gray-200">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-indigo-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-indigo-700 uppercase tracking-wider rounded-tl-lg">Year</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-indigo-700 uppercase tracking-wider">Plan</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-indigo-700 uppercase tracking-wider">Type</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-indigo-700 uppercase tracking-wider">Starting Value (€)</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-indigo-700 uppercase tracking-wider">Interest Earned This Year (€)</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-indigo-700 uppercase tracking-wider rounded-tr-lg">Ending Value (€)</th>
                        </tr>
                    </thead>
                    <tbody id="compoundInterestTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Rows will be populated dynamically by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Growth Chart: Visualizes the compound interest growth -->
        <div class="mb-10">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Investment Growth Over Time (€)</h2>
            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 h-[600px] sm:h-[600px] md:h-[600px] lg:h-[600px] xl:h-[600px]">
                <canvas id="growthChart"></canvas>
            </div>
        </div>

        <!-- NEW: Net Growth Chart: Visualizes investment growth minus fees -->
        <div class="mb-10">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Net Investment Growth Over Time minus fees (€)</h2>
            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 h-[600px] sm:h-[600px] md:h-[600px] lg:h-[600px] xl:h-[600px]">
                <canvas id="netGrowthChart"></canvas>
            </div>
        </div>

    </div>

    <script>
        // Global Constants for DIRT tax rate
        const DIRT_TAX_RATE = 0.33; // 33% DIRT tax

        // Global State Variables
        let billingPeriod = 'yearly'; // Default to 'yearly' billing
        let chartInstance; // To store the first Chart.js instance (Gross Growth)
        let netChartInstance; // To store the second Chart.js instance (Net Growth)

        // Initial Plan Data: Storing annual prices directly for initial yearly default.
        // Rates are stored as percentages (e.g., 0.86 means 0.86%).
        const plans = [
            { id: 'standard', name: 'Standard', yearlyPrice: 0, flexibleRate: 0.86, instantAER: 1.7 },
            { id: 'plus', name: 'Plus', yearlyPrice: 47.88, flexibleRate: 0.91, instantAER: 1.7 },
            { id: 'premium', name: 'Premium', yearlyPrice: 90, flexibleRate: 1.11, instantAER: 1.85 },
            { id: 'metal', name: 'Metal', yearlyPrice: 155, flexibleRate: 1.21, instantAER: 2 },
            { id: 'ultra', name: 'Ultra', yearlyPrice: 540, flexibleRate: 1.31, instantAER: 2.5 }
        ];

        /**
         * Reads input values from the DOM and updates the global plans array.
         * Ensures all rates are converted from percentage to decimal for calculations.
         * Also updates monthly/yearly prices based on the current billingPeriod.
         */
        function updatePlanDataFromInputs() {
            plans.forEach(plan => {
                const priceInput = document.getElementById(`${plan.id}Price`);
                if (priceInput) {
                    const inputValue = parseFloat(priceInput.value) || 0;

                    if (billingPeriod === 'yearly') {
                        plan.yearlyPrice = inputValue;
                        plan.monthlyPrice = inputValue / 12;
                    } else { // billingPeriod === 'monthly'
                        plan.monthlyPrice = inputValue;
                        plan.yearlyPrice = inputValue * 12;
                    }
                }

                const flexibleRateInput = document.getElementById(`flexible${plan.name}`);
                if (flexibleRateInput) {
                    plan.flexibleRate = parseFloat(flexibleRateInput.value) || 0;
                }

                const instantAERInput = document.getElementById(`instant${plan.name}`);
                if (instantAERInput) {
                    plan.instantAER = parseFloat(instantAERInput.value) || 0;
                    plan.instantNetRate = calculateInstantNetRateAsPercentage(plan.instantAER);
                }
            });
        }

        /**
         * Calculates the net interest rate for Instant Access Savings after DIRT tax.
         * The input and output are in percentage format (e.g., 1.85 for 1.85%).
         * Formula: AER_Percentage * (1 - DIRT_TAX_RATE)
         * @param {number} aerPercentage - The Annual Equivalent Rate (AER) as a percentage (e.g., 1.85 for 1.85%).
         * @returns {number} The net rate after tax as a percentage.
         */
        function calculateInstantNetRateAsPercentage(aerPercentage) {
            return aerPercentage * (1 - DIRT_TAX_RATE);
        }

        /**
         * Calculates the daily interest earned from a given investment and net annual rate.
         * The netRate is expected as a percentage (e.g., 1.11 for 1.11%).
         * @param {number} investment - The total investment amount.
         * @param {number} netRatePercentage - The net annual interest rate as a percentage.
         * @returns {number} The daily interest earned. Returns 0 if inputs are invalid.
         */
        function calculateDailyInterest(investment, netRatePercentage) {
            if (investment <= 0 || netRatePercentage <= 0) return 0;
            // Convert percentage to decimal for calculation: netRatePercentage / 100
            return (investment * (netRatePercentage / 100) / 365);
        }

        /**
         * Renders or updates the Plan Overview table with current plan costs and interest rates.
         * Rates are displayed as percentages as stored in the plan object.
         */
        function renderPlanOverviewTable() {
            const tbody = document.getElementById('planOverviewTableBody');
            tbody.innerHTML = ''; // Clear existing rows

            // Update the cost unit in the table header based on the selected billing period
            document.getElementById('costUnit').textContent = billingPeriod === 'monthly' ? '€/Month' : '€/Year';
            document.getElementById('annualCostUnit').textContent = '€/Year'; // Always annual for break-even

            plans.forEach(plan => {
                const row = document.createElement('tr');
                row.classList.add('hover:bg-gray-50'); // Add hover effect for table rows
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${plan.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-mono">${(billingPeriod === 'monthly' ? plan.monthlyPrice : plan.yearlyPrice).toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-mono">${plan.flexibleRate.toFixed(4)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-mono">${plan.instantAER.toFixed(4)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-mono">${plan.instantNetRate.toFixed(4)}</td>
                `;
                tbody.appendChild(row);
            });
        }

        /**
         * Renders or updates the Break-Even Amounts table.
         * Calculations are based on the additional net interest rate compared to the best Standard tier option.
         * Rates are handled as percentages and converted to decimals for calculation as needed.
         */
        function renderBreakEvenTable() {
            const tbody = document.getElementById('breakEvenTableBody');
            tbody.innerHTML = ''; // Clear existing rows

            // Find the Standard plan to use as a baseline
            const standardPlan = plans.find(p => p.id === 'standard');
            // Determine the best net rate (in percentage) between Flexible Cash Fund and Instant Access Savings for the Standard plan
            const standardBestNetRatePercentage = Math.max(standardPlan.flexibleRate, standardPlan.instantNetRate);

            // Filter out the Standard plan as we are comparing against it
            plans.filter(plan => plan.id !== 'standard').forEach(plan => {
                const row = document.createElement('tr');
                row.classList.add('hover:bg-gray-50');

                // Get the current plan's annual cost (based on selected billing period)
                const currentPlanAnnualCost = plan.yearlyPrice; // Always use yearly price for break-even
                // Determine the best net rate (in percentage) for the current paid plan
                const currentPlanMaxNetRatePercentage = Math.max(plan.flexibleRate, plan.instantNetRate);
                // Calculate the additional net rate (in percentage) this plan offers compared to the Standard baseline
                const additionalNetRatePercentage = currentPlanMaxNetRatePercentage - standardBestNetRatePercentage;

                let breakEvenAmount = 'N/A'; // Default value
                if (additionalNetRatePercentage > 0) {
                    // Calculate break-even amount: Annual Cost / (Additional Net Rate / 100)
                    breakEvenAmount = (currentPlanAnnualCost / (additionalNetRatePercentage / 100)).toFixed(2);
                } else if (additionalNetRatePercentage === 0) {
                    breakEvenAmount = 'Infinite (No additional gain)';
                } else {
                    breakEvenAmount = 'No break-even (Negative additional gain)';
                }

                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${plan.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-mono">${currentPlanAnnualCost.toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-mono">${additionalNetRatePercentage.toFixed(4)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-mono">${breakEvenAmount}</td>
                `;
                tbody.appendChild(row);
            });
        }

        /**
         * Renders or updates the Daily Interest Earnings table for a user-specified investment amount.
         * Rates are used as percentages and converted to decimals for calculation.
         */
        function renderDailyInterestTable() {
            const tbody = document.getElementById('dailyInterestTableBody');
            tbody.innerHTML = ''; // Clear existing rows

            // Get the user's entered investment amount
            const investmentAmount = parseFloat(document.getElementById('investmentAmount').value) || 0;

            plans.forEach(plan => {
                const row = document.createElement('tr');
                row.classList.add('hover:bg-gray-50');

                // Calculate daily interest for both Flexible and Instant Access for the current plan
                // Pass percentage rates to calculateDailyInterest which handles conversion to decimal
                const flexibleDailyInterest = calculateDailyInterest(investmentAmount, plan.flexibleRate).toFixed(2);
                const instantDailyInterest = calculateDailyInterest(investmentAmount, plan.instantNetRate).toFixed(2);

                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${plan.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-mono">€${flexibleDailyInterest}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-mono">€${instantDailyInterest}</td>
                `;
                tbody.appendChild(row);
            });
        }

        /**
         * Calculates and renders compound interest growth over time in a table format.
         * Also prepares data for both gross and net growth charts.
         */
        function renderCompoundInterestTable() {
            const tbody = document.getElementById('compoundInterestTableBody');
            tbody.innerHTML = ''; // Clear existing rows

            const initialInvestment = parseFloat(document.getElementById('investmentAmount').value) || 0;
            const years = parseInt(document.getElementById('compoundPeriodYears').value) || 0;

            const compoundDataForChart = []; // Array to store data for the Chart.js graph (Gross)
            const netCompoundDataForChart = []; // Array to store data for the Net Growth Chart

            if (initialInvestment <= 0 || years <= 0) {
                 // Clear charts if no valid investment or years are entered
                if (chartInstance) {
                    chartInstance.destroy();
                    chartInstance = null;
                }
                if (netChartInstance) {
                    netChartInstance.destroy();
                    netChartInstance = null;
                }
                return;
            }

            plans.forEach(plan => {
                // Initialize current values for Flexible and Instant for each plan
                let currentFlexibleValue = initialInvestment;
                let currentInstantValue = initialInvestment;

                // Initialize current values for Net Flexible and Net Instant for each plan
                let currentFlexibleNetValue = initialInvestment;
                let currentInstantNetValue = initialInvestment;

                // Rates are divided by 100 here to convert from percentage to decimal for calculation
                const flexibleRateDecimal = plan.flexibleRate / 100;
                const instantNetRateDecimal = plan.instantNetRate / 100;

                // Determine annual fee for the current plan
                const annualFee = plan.yearlyPrice; // Use yearlyPrice stored in plan object

                // Arrays to store growth data over the years for the chart
                const flexibleCompoundGrowth = [initialInvestment];
                const instantCompoundGrowth = [initialInvestment];
                const flexibleNetCompoundGrowth = [initialInvestment]; // For Net Chart
                const instantNetCompoundGrowth = [initialInvestment];   // For Net Chart


                // Add a bold header row for each plan in the table
                const headerRow = document.createElement('tr');
                headerRow.classList.add('bg-gray-100', 'font-semibold');
                headerRow.innerHTML = `
                    <td colspan="6" class="px-6 py-3 text-lg text-gray-900 text-center">${plan.name}</td>
                `;
                tbody.appendChild(headerRow);

                // Loop through each year to calculate compound interest
                for (let year = 1; year <= years; year++) {
                    // Flexible Cash Fund calculations (Gross)
                    const flexibleInterestThisYear = currentFlexibleValue * flexibleRateDecimal;
                    currentFlexibleValue += flexibleInterestThisYear;
                    flexibleCompoundGrowth.push(currentFlexibleValue); // Store for gross chart

                    // Flexible Cash Fund calculations (Net - deducting fees)
                    const flexibleNetInterestThisYear = currentFlexibleNetValue * flexibleRateDecimal;
                    currentFlexibleNetValue = currentFlexibleNetValue + flexibleNetInterestThisYear - annualFee;
                    flexibleNetCompoundGrowth.push(currentFlexibleNetValue); // Store for net chart


                    const flexibleRow = document.createElement('tr');
                    flexibleRow.classList.add('hover:bg-gray-50');
                    flexibleRow.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-mono">${year}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${plan.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Flexible Cash Fund</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-mono">€${(flexibleCompoundGrowth[year-1]).toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-mono">€${flexibleInterestThisYear.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-mono">€${currentFlexibleValue.toFixed(2)}</td>
                    `;
                    tbody.appendChild(flexibleRow);

                    // Instant Access Savings calculations (Gross)
                    const instantInterestThisYear = currentInstantValue * instantNetRateDecimal;
                    currentInstantValue += instantInterestThisYear;
                    instantCompoundGrowth.push(currentInstantValue); // Store for gross chart

                    // Instant Access Savings calculations (Net - deducting fees)
                    const instantNetInterestThisYear = currentInstantNetValue * instantNetRateDecimal;
                    currentInstantNetValue = currentInstantNetValue + instantNetInterestThisYear - annualFee;
                    instantNetCompoundGrowth.push(currentInstantNetValue); // Store for net chart

                    const instantRow = document.createElement('tr');
                    instantRow.classList.add('hover:bg-gray-50');
                    instantRow.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-mono">${year}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${plan.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Instant Access Savings</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-mono">€${(instantCompoundGrowth[year-1]).toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-mono">€${instantInterestThisYear.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-mono">€${currentInstantValue.toFixed(2)}</td>
                    `;
                    tbody.appendChild(instantRow);
                }

                // Add data for this plan to the chart dataset (Gross)
                compoundDataForChart.push({
                    planName: `${plan.name} (Flexible)`,
                    data: flexibleCompoundGrowth,
                    borderColor: `hsl(${Math.random() * 360}, 70%, 50%)`,
                    backgroundColor: `hsl(${Math.random() * 360}, 70%, 50%, 0.2)`
                });
                compoundDataForChart.push({
                    planName: `${plan.name} (Instant)`,
                    data: instantCompoundGrowth,
                    borderColor: `hsl(${Math.random() * 360}, 70%, 50%)`,
                    backgroundColor: `hsl(${Math.random() * 360}, 70%, 50%, 0.2)`
                });

                // Add data for this plan to the Net chart dataset
                netCompoundDataForChart.push({
                    planName: `${plan.name} (Flexible)`,
                    data: flexibleNetCompoundGrowth,
                    borderColor: `hsl(${Math.random() * 360}, 70%, 50%)`,
                    backgroundColor: `hsl(${Math.random() * 360}, 70%, 50%, 0.2)`
                });
                netCompoundDataForChart.push({
                    planName: `${plan.name} (Instant)`,
                    data: instantNetCompoundGrowth,
                    borderColor: `hsl(${Math.random() * 360}, 70%, 50%)`,
                    backgroundColor: `hsl(${Math.random() * 360}, 70%, 50%, 0.2)`
                });
            });

            // Update both Chart.js graphs with the new compound data
            updateGrowthChart(compoundDataForChart, initialInvestment, years, 'growthChart', chartInstance);
            updateGrowthChart(netCompoundDataForChart, initialInvestment, years, 'netGrowthChart', netChartInstance);
        }

        /**
         * Updates a Chart.js graph to visualize investment growth over time.
         * Reused for both gross and net charts.
         * @param {Array<Object>} data - Array of objects, each containing `planName`, `data` (array of values), `borderColor`, and `backgroundColor`.
         * @param {number} initialInvestment - The initial investment amount (for chart scaling).
         * @param {number} years - The number of years for the chart's X-axis labels.
         * @param {string} canvasId - The ID of the canvas element to render the chart on.
         * @param {object} currentChartInstance - The current Chart.js instance associated with the canvas.
         */
        function updateGrowthChart(data, initialInvestment, years, canvasId, currentChartInstance) {
            const ctx = document.getElementById(canvasId).getContext('2d');

            // Destroy any existing chart instance to prevent memory leaks and redraw correctly
            if (currentChartInstance) {
                currentChartInstance.destroy();
            }

            // Create labels for the X-axis (Year 0, Year 1, ..., Year N)
            const labels = Array.from({ length: years + 1 }, (_, i) => `Year ${i}`);

            let yAxisMin;
            if (canvasId === 'growthChart') {
                yAxisMin = initialInvestment > 0 ? initialInvestment : 0;
            } else { // 'netGrowthChart'
                // For the net chart, calculate min based on potential losses
                const allNetValues = data.flatMap(d => d.data);
                yAxisMin = Math.min(initialInvestment, ...allNetValues);
                // Add some padding below the lowest value if it's negative or close to zero
                yAxisMin = yAxisMin - (Math.abs(yAxisMin) * 0.1);
                if (initialInvestment === 0) { // If initial investment is zero, start at 0 or below if negative growth
                    yAxisMin = Math.min(0, ...allNetValues) - (Math.abs(Math.min(0, ...allNetValues)) * 0.1);
                }
            }


            // Initialize a new Chart.js instance
            const newChart = new Chart(ctx, {
                type: 'line', // Line chart for showing growth over time
                data: {
                    labels: labels,
                    datasets: data.map(item => ({
                        label: item.planName,
                        data: item.data,
                        borderColor: item.borderColor,
                        backgroundColor: item.backgroundColor,
                        borderWidth: 2,
                        fill: false, // Do not fill area under the line
                        tension: 0.1 // Slight curve for lines
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // Allows the chart to scale freely within its container
                    aspectRatio: 0.5, // Keeps the chart ~3 times taller
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Year',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                display: false // Hide vertical grid lines
                            }
                        },
                        y: {
                            beginAtZero: false, // Set to false to start from a non-zero minimum
                            min: yAxisMin, // Set minimum dynamically
                            title: {
                                display: true,
                                text: 'Value (€)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                // Format Y-axis ticks as currency
                                callback: function(value, index, values) {
                                    return new Intl.NumberFormat('en-IE', { style: 'currency', currency: 'EUR' }).format(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom', // Place legend at the bottom
                            labels: {
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                // Custom tooltip label to format values as currency
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += new Intl.NumberFormat('en-IE', { style: 'currency', currency: 'EUR' }).format(context.raw);
                                    return label;
                                }
                            },
                            backgroundColor: 'rgba(0, 0, 0, 0.7)',
                            bodyFont: {
                                size: 14
                            },
                            titleFont: {
                                size: 14
                            },
                            padding: 10,
                            cornerRadius: 8
                        }
                    },
                    animation: {
                        duration: 1000, // Smooth animation on updates
                        easing: 'easeInOutQuad'
                    }
                }
            });

            // Update the global chart instance variable based on which chart is being updated
            if (canvasId === 'growthChart') {
                chartInstance = newChart;
            } else if (canvasId === 'netGrowthChart') {
                netChartInstance = newChart;
            }
        }

        /**
         * Main function to orchestrate all calculations and update the UI elements.
         * This function is called whenever an relevant input changes.
         */
        function calculateAll() {
            updatePlanDataFromInputs(); // First, update the internal data model
            renderPlanOverviewTable();    // Then, re-render all tables
            renderBreakEvenTable();
            renderDailyInterestTable();
            renderCompoundInterestTable(); // This function will internally call updateGrowthChart for both charts
        }

        /**
         * Initializes the application when the DOM is fully loaded.
         * Populates input fields with initial data, sets up all event listeners,
         * and performs the initial set of calculations and rendering.
         */
        function initializeApp() {
            // Set billing period initially to yearly
            billingPeriod = 'yearly';

            // Populate initial input values for plan prices and attach input listeners
            plans.forEach(plan => {
                const priceInput = document.getElementById(`${plan.id}Price`);
                if (priceInput) {
                    // Display the yearly price as default
                    priceInput.value = plan.yearlyPrice.toFixed(2);
                    priceInput.addEventListener('input', calculateAll);
                }

                // Populate and attach listeners for Flexible Cash Fund rates
                const flexibleRateInput = document.getElementById(`flexible${plan.name}`);
                if (flexibleRateInput) {
                    // Display rates as percentages (e.g., 0.86)
                    flexibleRateInput.value = plan.flexibleRate.toFixed(2);
                    flexibleRateInput.addEventListener('input', calculateAll);
                }

                // Populate and attach listeners for Instant Access Savings AER rates
                const instantAERInput = document.getElementById(`instant${plan.name}`);
                if (instantAERInput) {
                    // Display rates as percentages (e.g., 1.7)
                    instantAERInput.value = plan.instantAER.toFixed(2);
                    instantAERInput.addEventListener('input', calculateAll);
                }
            });

            // Add listener for the main investment amount input
            document.getElementById('investmentAmount').addEventListener('input', calculateAll);

            // Add listener for the compound period years input
            document.getElementById('compoundPeriodYears').addEventListener('input', calculateAll);

            // Listener for the billing period toggle switch
            const billingToggle = document.getElementById('billingToggle');
            // Ensure the toggle is checked for yearly by default in HTML, so no need to programmatically set its state here
            billingToggle.addEventListener('change', (event) => {
                billingPeriod = event.target.checked ? 'yearly' : 'monthly';

                // Adjust the displayed price in the input fields when toggling
                plans.forEach(plan => {
                    const priceInput = document.getElementById(`${plan.id}Price`);
                    if (priceInput && plan.id !== 'standard') {
                        if (billingPeriod === 'yearly') {
                            // If switching to yearly, show the stored yearly price
                            priceInput.value = plan.yearlyPrice.toFixed(2);
                        } else {
                            // If switching to monthly, show the calculated monthly price (yearly / 12)
                            priceInput.value = (plan.yearlyPrice / 12).toFixed(2);
                        }
                    }
                });
                calculateAll(); // Trigger full recalculation
            });

            // Perform initial calculations and rendering when the app loads
            calculateAll();
        }

        // Ensure the app initializes once the entire DOM content is loaded
        document.addEventListener('DOMContentLoaded', initializeApp);

    </script>
</body>
</html>
